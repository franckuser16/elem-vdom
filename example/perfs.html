<!DOCTYPE html>
<html>
    <head>
        <title>DEMO</title>
        <link rel="stylesheet" href="./css/bootstrap.min.css">
    </head>
    <body>
        <div class="container-fluid">
            <div class="row">
                <div id="app" class="col-md-12"></div>
            </div>
        </div>
        <script src="/assets/elem.js" type="text/javascript"></script>
        <script src="./js/moment.min.js" type="text/javascript"></script>
        <script src="./js/ENV.js"></script>
        <script src="./js/memory-stats.js"></script>
        <script src="./js/monitor.js"></script>
        <script type="text/javascript">

          var DBMon = Elem.component({
            init: function() {
              this.loadSamples();
            },

            getInitialState: function() {
              return {
                databases: []
              };
            },

            loadSamples: function() {
              this.setState({ databases: ENV.generateData().toArray() });
              Monitoring.renderRate.ping();
              setTimeout(this.loadSamples, ENV.timeout);
            },

            render: function() {
              return (
                Elem.el('div', [
                  Elem.el('table', { className: "table table-striped latest-data" }, [
                    Elem.el('tbody', this.state().databases.map(function(database) {

                      var base = [
                        Elem.el('td', { className: "dbname" }, database.dbname),
                        Elem.el('td', { className: "query-count" },
                          Elem.el('span', { className: database.lastSample.countClassName }, database.lastSample.queries.length)
                        )
                      ];

                      base = base.concat(
                        database.lastSample.topFiveQueries.map(function(query, index) {
                          return Elem.el('td', { className: "Query " + query.elapsedClassName }, [
                            Elem.el('span', query.formatElapsed),
                            Elem.el('div', { className: "popover left" }, [
                              Elem.el('div', { className: "popover-content" }, query.query),
                              Elem.el('div', { className: "arrow" }, '')
                            ])
                          ]);
                        })
                      );

                      return Elem.el('tr', { key: database.dbname }, base);
                    }))
                  ])
                ])
              );
            }
          });

          DBMon({}).renderTo('#app');
        </script>
    </body>
</html>
